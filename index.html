<script>
        // *** 1. ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Apps Script ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ***
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxPypaStZQs-LUQmN49o3BIXIpHnOQEdEzZ2xNW7YPo2roM-ZtHqbk_jholUyIuymvBhA/exec';

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà Paste
        function processData() {
            const rawText = document.getElementById('rawInput').value;
            
            // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô
            resetFields();

            // 1. ‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó (‡πÄ‡∏≠‡∏≤‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á)
            const lines = rawText.split('\n').filter(line => line.trim() !== '');
            if (lines.length > 0) {
                // ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "‡∏ä‡∏∑‡πà‡∏≠ :" ‡∏´‡∏£‡∏∑‡∏≠ "Company :" ‡∏≠‡∏≠‡∏Å ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
                let name = lines[0].replace(/^(‡∏ä‡∏∑‡πà‡∏≠|Company|Name)\s*[:\-\.]\s*/i, '');
                document.getElementById('companyName').value = name.trim();
            }

            // 2. ‡∏´‡∏≤‡∏≠‡∏µ‡πÄ‡∏°‡∏• (Email) - ‡∏°‡∏≠‡∏á‡∏´‡∏≤ @
            const emailMatch = rawText.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/);
            if (emailMatch) document.getElementById('email').value = emailMatch[0];

            // 3. ‡∏´‡∏≤‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ (Phone) - ‡∏°‡∏≠‡∏á‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 9-10 ‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ 0
            // ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö 0xx-xxx-xxxx, 0xx xxx xxxx, 02-xxx-xxxx
            const phoneMatch = rawText.match(/(0\d{1,2}[-\s]?\d{3,4}[-\s]?\d{3,4})/);
            if (phoneMatch) document.getElementById('phone').value = phoneMatch[0];

            // 4. ‡∏´‡∏≤‡πÄ‡∏•‡∏Ç‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ (Tax ID) - ‡∏°‡∏≠‡∏á‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô 13 ‡∏´‡∏•‡∏±‡∏Å
            const taxMatch = rawText.match(/\b\d{13}\b/);
            if (taxMatch) {
                document.getElementById('taxId').value = taxMatch[0];
            } else {
                // ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Ç‡∏µ‡∏î‡∏Ñ‡∏±‡πà‡∏ô ‡πÄ‡∏ä‡πà‡∏ô 0-1055-300-XXXX-X
                const taxMatchWithDash = rawText.match(/\d{1}-\d{4}-\d{3}-\d{2}-\d{1}/); // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡πà‡∏≤‡∏ß‡πÜ
                // ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≠‡∏á‡∏´‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤
                const taxKeywordMatch = rawText.match(/(‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ|Tax ID)\s*[:\-\.]?\s*([\d\-\s]+)/i);
                if (taxKeywordMatch) document.getElementById('taxId').value = taxKeywordMatch[2].trim();
            }

            // 5. ‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (Address) - ‡∏¢‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏î‡∏≤
            // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£: ‡∏´‡∏≤‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "‡πÅ‡∏Ç‡∏ß‡∏á", "‡πÄ‡∏Ç‡∏ï", "‡∏ñ‡∏ô‡∏ô", "‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î", "‡∏Å‡∏ó‡∏°", "Bangkok"
            let addressLines = [];
            const addressKeywords = ['‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', '‡∏´‡∏°‡∏π‡πà', '‡∏ã‡∏≠‡∏¢', '‡∏ñ‡∏ô‡∏ô', '‡πÅ‡∏Ç‡∏ß‡∏á', '‡∏ï.', '‡∏ï‡∏≥‡∏ö‡∏•', '‡πÄ‡∏Ç‡∏ï', '‡∏≠.', '‡∏≠‡∏≥‡πÄ‡∏†‡∏≠', '‡∏à.', '‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î', '‡∏Å‡∏ó‡∏°', 'Bangkok', 'Road', 'Street'];
            
            lines.forEach((line, index) => {
                // ‡∏Ç‡πâ‡∏≤‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÅ‡∏£‡∏Å (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó)
                if (index === 0) return; 

                // ‡∏ñ‡πâ‡∏≤‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏±‡πâ‡∏ô‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ
                const hasKeyword = addressKeywords.some(kw => line.includes(kw));
                // ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏±‡πâ‡∏ô‡∏¢‡∏≤‡∏ß‡∏û‡∏≠‡∏™‡∏°‡∏Ñ‡∏ß‡∏£‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà/‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå)
                const hasNumber = /\d/.test(line);

                if (hasKeyword && hasNumber) {
                    addressLines.push(line.trim());
                }
            });

            // ‡πÄ‡∏≠‡∏≤‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏à‡∏≠‡∏°‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô
            if (addressLines.length > 0) {
                document.getElementById('address').value = addressLines.join(' ');
            }
        }

        function resetFields() {
            document.getElementById('companyName').value = '';
            document.getElementById('address').value = '';
            document.getElementById('taxId').value = '';
            document.getElementById('phone').value = '';
            document.getElementById('email').value = '';
        }

        function saveToSheet() {
            if(GOOGLE_SCRIPT_URL.includes('‡∏ß‡∏≤‡∏á_URL') || GOOGLE_SCRIPT_URL === '') {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á Google Apps Script ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ö‡∏ô‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö');
                return;
            }

            const btn = document.getElementById('btnSave');
            const status = document.getElementById('statusMsg');
            
            const data = {
                company: document.getElementById('companyName').value,
                address: document.getElementById('address').value,
                taxId: document.getElementById('taxId').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value
            };

            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á
            btn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
            btn.disabled = true;
            btn.classList.add('opacity-50');

            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', 
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify(data)
            })
            .then(() => {
                btn.innerHTML = '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
                btn.classList.replace('bg-green-600', 'bg-blue-600');
                status.innerText = '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Google Sheet ‡πÅ‡∏•‡πâ‡∏ß';
                status.classList.remove('text-red-500');
                status.classList.add('text-green-600');
                
                setTimeout(() => {
                    btn.innerHTML = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Google Sheet';
                    btn.disabled = false;
                    btn.classList.remove('opacity-50');
                    btn.classList.replace('bg-blue-600', 'bg-green-600');
                    status.innerText = '';
                }, 3000);
            })
            .catch(error => {
                console.error('Error:', error);
                btn.innerHTML = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î';
                status.innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏ä‡πá‡∏Ñ URL ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï';
                status.classList.add('text-red-500');
                btn.disabled = false;
            });
        }
    </script>
